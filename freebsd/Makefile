# $FreeBSD$

PORTNAME=gocd-server
DISTVERSION=19.2.0-8641
CATEGORIES=devel java
MASTER_SITES=https://download.gocd.org/binaries/${DISTVERSION}/generic/
DISTFILES=go-server-${DISTVERSION}.zip

MAINTAINER=hs@aikchar.dev
COMMENT=An open-source Continuous Integration and Continuous Delivery system

LICENSE=APACHE20

DISTNAME=go-server-19.2.0
EXTRACT_ONLY=go-server-${DISTVERSION}.zip
EXTRACT_CMD=${UNZIP_NATIVE_CMD} ${DISTDIR}/${EXTRACT_ONLY}

NO_BUILD=yes
USE_JAVA=yes
USE_RUBY=yes
JAVA_VERSION=1.8+
NO_ARCH=
TMPDIR?=/tmp

GOCD_SERVER_HOME?=${PREFIX}/gocd-server
GOCD_SERVER_CONFIG_DIR?=${LOCALBASE}/etc/gocd-server
GOCD_SERVER_LOG_FILE?=/var/log/gocd-server.log
GOCD_SERVER_MEM?=512m
GOCD_SERVER_MAX_MEM?=1g
GOCD_SERVER_MAX_METASPACE?=400m
GOCD_SERVER_PORT?=8153
GOCD_SERVER_SSL_PORT?=8154
GOCD_SERVER_USER_LANG?=en
GOCD_SERVER_USER_COUNTRY?=US
GOCD_SERVER_USER?=gocd
GOCD_SERVER_GROUP?=gocd
GOCD_SERVER_LISTEN_HOST?=

.if ${GOCD_SERVER_USER} == "gocd"
USERS=gocd
.endif
.if ${GOCD_SERVER_GROUP} == "gocd"
GROUPS=gocd
.endif

SUB_LIST+=GOCD_SERVER_CONFIG_DIR=${GOCD_SERVER_CONFIG_DIR} \
		GOCD_SERVER_LOG_FILE=${GOCD_SERVER_LOG_FILE} \
		GOCD_SERVER_MEM=${GOCD_SERVER_MEM} \
		GOCD_SERVER_MAX_MEM=${GOCD_SERVER_MAX_MEM} \
		GOCD_SERVER_MAX_METASPACE=${GOCD_SERVER_MAX_METASPACE} \
		GOCD_SERVER_PORT=${GOCD_SERVER_PORT} \
		GOCD_SERVER_SSL_PORT=${GOCD_SERVER_SSL_PORT} \
		GOCD_SERVER_USER_LANG=${GOCD_SERVER_USER_LANG} \
		GOCD_SERVER_USER_COUNTRY=${GOCD_SERVER_USER_COUNTRY} \
		GOCD_SERVER_USER=${GOCD_SERVER_USER} \
		GOCD_SERVER_GROUP=${GOCD_SERVER_GROUP} \
		GOCD_SERVER_LISTEN_HOST=${GOCD_SERVER_LISTEN_HOST} \
		JAVA_HOME=${JAVA_HOME} \
		JAVAJARDIR=${JAVAJARDIR} \
		TMPDIR=${TMPDIR}
PLIST_SUB+=GOCD_SERVER_USER=${GOCD_SERVER_USER} \
		GOCD_SERVER_GROUP=${GOCD_SERVER_GROUP} \
		JAVAJARDIR=${JAVAJARDIR}

USE_RC_SUBR=gocd-server

do-install:
		${MKDIR} ${STAGEDIR}${JAVAJARDIR} ${STAGEDIR}${GOCD_SERVER_HOME}
		${INSTALL_DATA} ${INSTALL_WRKSRC}/go.jar ${STAGEDIR}${JAVAJARDIR}

.include <bsd.port.mk>
